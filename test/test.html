<!doctype html>
<html>
  <head>
    <title>Bobble Test</title>
    <link href="test.css" media="screen" rel="stylesheet" type="text/css" />
    <script type="text/javascript" language="JavaScript" src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.1.0/prototype.js"></script>
    <script type="text/javascript" language="JavaScript" src="../src/bobble.js"></script>
  </head>
  <body>



<script class="js-test" type="text/html">
// Time cannot go backwards
assertThrows(function() {
  advanceToTime(1);
  advanceToTime(0);
}, "Expected error to have been raised when attempting to rewind time");
</script>



<script class="js-test" type="text/html">
// setTimeout does not fire early
var a = false;
setTimeout(function() { a = true; }, 100);
advanceToTime(99);
assertEquals(false, a, "Expected setTimeout not to have fired early");
</script>



<script class="js-test" type="text/html">
// setTimeout does not fire early relative to current time
var a = false;
advanceToTime(50);
setTimeout( function() { a = true; }, 100);
advanceToTime(149);
assertEquals(false, a, "Expected setTimeout not to have fired early");
</script>



<script class="js-test" type="text/html">
// setTimeout fires relative to current time
var a = false;
advanceToTime(50);
setTimeout( function() { a = true; }, 100);
advanceToTime(150);
assertEquals(true, a, "Expected setTimeout to have fired after elapsed time");
</script>



<script class="js-test" type="text/html">
// setTimeout does not repeat
var a = false;
setTimeout( function() { a = true; }, 100);
advanceToTime(100);
assertEquals(true, a, "Expected setTimeout to have fired once");
a = false;
advanceToTime(200);
assertEquals(false, a, "Expected setTimeout not to have fired again");
</script>



<script class="js-test" type="text/html">
// setInterval repeats
var a = false;
setInterval( function() { a = true; }, 100);
advanceToTime(100);
assertEquals(true, a, "Expected setInterval to have fired once");
a = false;
advanceToTime(200);
assertEquals(true, a, "Expected setInterval to have fired again");
</script>



<script class="js-test" type="text/html">
// clearTimeout clears
var a = false;
var timeout = setTimeout(function() { a = true; }, 100);
clearTimeout(timeout);
advanceToTime(100);
assertEquals(false, a, "Expected cleared setTimeout not to have fired");
</script>



<script class="js-test" type="text/html">
// clearInterval clears
var a = false;
var interval = setInterval(function() { a = true; }, 100);
advanceToTime(100);
assertEquals(true, a, "Expected setInterval to have fired before clearing");
a = false;
clearInterval(interval);
advanceToTime(200);
assertEquals(false, a, "Expected cleared setInterval not to have fired again");
</script>



<script class="js-test" type="text/html">
// new Date() is controlled by bobble
var then = new Date();
advanceToTime(100);
var now = new Date();
assertEquals(100, now - then, "Expected bobble time to control Date");
</script>



<script class="js-test" type="text/html">
// Explicit Date constructor signatures work correctly
assertEquals(1275785813010, new Date(1275785813010));
assertEquals(1275785813000, new Date("2010-06-05 17:56:53 GMT-0700 (PDT)"));
assertEquals(1277967600000, new Date(2010, 6));
assertEquals(1278313200000, new Date(2010, 6, 5));
assertEquals(1278374400000, new Date(2010, 6, 5, 17));
assertEquals(1278377760000, new Date(2010, 6, 5, 17, 56));
assertEquals(1278377813000, new Date(2010, 6, 5, 17, 56, 53));
assertEquals(1278377813010, new Date(2010, 6, 5, 17, 56, 53, 10));
</script>



  <script class="js-test-result-template" type="text/html">
  <div class="js-test-result-status js-test-result-status-#{test_result}">
    <pre>#{function_body}</pre>
    <pre class="js-test-failure-message">#{failure_message}</pre>
  </div>
  </script>
  <script class="js-test-results-summary-template" type="text/html">
  <div class="js-test-results-summary">
    <pre>#{successes} Successes, #{failures} Failures</pre>
  </div>
  </script>
  
  <script type="text/javascript" language="JavaScript" src="bobbled-tests-runner.js"></script>
  
  </body>
</html>
