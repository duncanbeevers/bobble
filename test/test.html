<!doctype html>
<html>
  <head>
    <title>Bobble Test</title>
    <link href="test.css" media="screen" rel="stylesheet" type="text/css" />
    <script type="text/javascript" language="JavaScript" src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.1.0/prototype.js"></script>
    <script type="text/javascript" language="JavaScript" src="../src/bobble.js"></script>
  </head>
  <body>

<script class="js-test" type="text/html">
// Time cannot go backwards
assertThrows(function() {
  advanceToTime(1);
  advanceToTime(0);
}, "Expected error to have been raised when attempting to rewind time");
</script>

<script class="js-test" type="text/html">
var a = false;

advanceToTime(50);

setTimeout(
  function() { a = true; },
  100);

advanceToTime(149);
assertEquals(false, a, "Expected setTimeout not to have fired after 149 simulated milliseconds");

advanceToTime(150);
assertEquals(true, a, "Expected setTimeout to have fired after 150 simulated milliseconds");

a = false;
advanceToTime(250);
assertEquals(false, a, "Expected setTimeout not to have fired again after 250 simulated milliseconds");
</script>

<script class="js-test" type="text/html">
var a = false;

advanceToTime(50);

setInterval(
  function() { a = true; },
  100);

advanceToTime(149);
assertEquals(false, a, "Expected setInterval not to have fired after 149 simulated milliseconds");

advanceToTime(150);
assertEquals(true, a, "Expected setInterval to have fired after 150 simulated milliseconds");

a = false;
advanceToTime(249);
assertEquals(false, a, "Expected setInterval not to have fired again after 249 simulated milliseconds");

advanceToTime(250);
assertEquals(true, a, "Expected setInterval to have fired again after 250 simulated milliseconds");
</script>

<script class="js-test" type="text/html">
var a = false;

setTimeout(
  function() { a = true; },
  100);

assertEquals(false, a, "Expected setTimeout not to have fired before advancing milliseconds");

advanceToTime(99);
assertEquals(false, a, "Expected setTimeout not to have fired after 99 simulated milliseconds");

advanceToTime(100);
assertEquals(true, a, "Expected setTimeout to have fired after 100 simulated milliseconds");
</script>

<script class="js-test" type="text/html">
var a = false;

var timeout = setTimeout(
  function() { a = true; },
  100);

clearTimeout(timeout);

advanceToTime(100);
assertEquals(false, a, "Expected cleared setTimeout not to have fired after 100 simulated milliseconds");
</script>

<script class="js-test" type="text/html">
var a = false;

var interval = setInterval(
  function() { a = true; },
  100);

clearInterval(interval);

advanceToTime(100);
assertEquals(false, a, "Expected cleared setInterval not to have fired after 100 simulated milliseconds");
</script>

<script class="js-test" type="text/html">
var then = new Date();
advanceToTime(100);

var now = new Date();
assertEquals(100, now - then, "Expected bobble time to control Date");
</script>

<script class="js-test" type="text/html">
assertEquals(1275785813010, new Date(1275785813010));
assertEquals(1275785813000, new Date("2010-06-05 17:56:53 GMT-0700 (PDT)"));
assertEquals(1277967600000, new Date(2010, 6));
assertEquals(1278313200000, new Date(2010, 6, 5));
assertEquals(1278374400000, new Date(2010, 6, 5, 17));
assertEquals(1278377760000, new Date(2010, 6, 5, 17, 56));
assertEquals(1278377813000, new Date(2010, 6, 5, 17, 56, 53));
assertEquals(1278377813010, new Date(2010, 6, 5, 17, 56, 53, 10));
</script>

<script class="js-test-result-template" type="text/html">
<div class="js-test-result-status js-test-result-status-#{test_result}">
  <pre>#{function_body}</pre>
  <pre class="js-test-failure-message">#{failure_message}</pre>
</div>
</script>
<script class="js-test-results-summary-template" type="text/html">
<div class="js-test-results-summary">
  <pre>#{successes} Successes, #{failures} Failures</pre>
</div>
</script>

<script type="text/javascript" language="JavaScript" src="bobbled-tests-runner.js"></script>

  </body>
</html>
